{
  "meta": {
    "project": "MCP Server Backend Logic",
    "date": "2025-12-10",
    "prepared_by": "Generated by TestSprite"
  },
  "product_overview": "MCP Server Backend provides core backend API logic for a collaborative Bible reading platform, including user cell joining, translation toggling, verse underlining, theme management, and today's reading plan loading, supported by state persistence and local storage.",
  "core_goals": [
    "Enable users to join a cell group securely using invite codes with validation and duplicate handling.",
    "Allow switching Bible translations between KRV and EASY accurately, with appropriate state and UI updates.",
    "Support multi-user verse underlining with reliable toggle, duplicate prevention, and user distinction.",
    "Persist user state efficiently in local storage to maintain seamless user experience across sessions and reloads.",
    "Implement theme switching between light, dark, and system modes with smooth SSR hydration and UI updates.",
    "Load and display periodic reading plans asynchronously with proper loading UI and translation-based content.",
    "Provide robust error handling for invalid inputs and data overflow situations."
  ],
  "key_features": [
    "Cell Join API validating invite codes with error and success responses.",
    "Translation Toggle API enabling switching between KRV and EASY translations.",
    "Underline Toggle API for adding/removing verse underlines with multi-user support.",
    "Theme Toggle API cycling through light, dark, and system preference modes.",
    "Today Plan API fetching and displaying the daily reading passages and verses.",
    "LocalStorage based state persistence ensuring user state retention across reloads.",
    "Validation logic for blank, whitespace, case normalization, duplication, and invalid invite codes.",
    "Loading indicator UI during asynchronous operations for better user feedback.",
    "SSR hydration management to prevent UI flash on theme changes."
  ],
  "user_flow_summary": [
    "User inputs invite code to join a cell; system validates, handles duplicates, and confirms join status.",
    "User toggles Bible translation preference; verses and underlines update accordingly.",
    "User clicks verses to toggle underlining; system records multi-user underline state preventing duplicates.",
    "User switches theme preference; theme applies instantly across app with system mode detection.",
    "User views today's reading plan; system asynchronously loads passages and verses matching current translation.",
    "On app reload, local storage restores user state including user info, cells, underlines, and preferences."
  ],
  "validation_criteria": [
    "Empty or whitespace invite code inputs return error messages consistently.",
    "Invite codes normalized to uppercase for case insensitivity.",
    "Duplicate or invalid invite codes result in appropriate error responses.",
    "Verse underlining toggles correctly with no duplicate entries even on rapid clicks.",
    "Multi-user underline states stored distinctly by userId.",
    "State persistence reliably saves and restores data from local storage.",
    "Theme toggle adds/removes dark class to document root; OS preference mode detected.",
    "SSR hydration prevents flash of incorrect theme on reload.",
    "Today plan loads with 500ms delay showing loading UI.",
    "Translation toggling correctly updates text and underline states separately for each translation.",
    "Large data storage overflow handled gracefully without crashing."
  ],
  "code_summary": {
    "tech_stack": [
      "TypeScript",
      "Next.js 16",
      "Zustand",
      "Tailwind CSS",
      "Framer Motion"
    ],
    "features": [
      {
        "name": "Cell Join API (Mock)",
        "description": "Validates invite codes and adds user to cell. Returns success/error message.",
        "files": [
          "store/use-bible-store.ts"
        ],
        "api_doc": {
          "openapi": "3.0.0",
          "paths": {
            "/api/cells/join": {
              "post": {
                "summary": "Join a cell with invite code",
                "requestBody": {
                  "content": {
                    "application/json": {
                      "schema": {
                        "type": "object",
                        "properties": {
                          "inviteCode": {
                            "type": "string"
                          }
                        }
                      }
                    }
                  }
                },
                "responses": {
                  "200": {
                    "description": "Successfully joined"
                  },
                  "400": {
                    "description": "Invalid or duplicate code"
                  }
                }
              }
            }
          }
        }
      },
      {
        "name": "Translation Toggle API (Mock)",
        "description": "Switches Bible translation between KRV (개역개정) and EASY (쉬운성경). Updates verse content.",
        "files": [
          "store/use-bible-store.ts"
        ],
        "api_doc": {
          "openapi": "3.0.0",
          "paths": {
            "/api/translation": {
              "put": {
                "summary": "Set translation preference",
                "requestBody": {
                  "content": {
                    "application/json": {
                      "schema": {
                        "type": "object",
                        "properties": {
                          "translation": {
                            "type": "string",
                            "enum": [
                              "KRV",
                              "EASY"
                            ]
                          }
                        }
                      }
                    }
                  }
                },
                "responses": {
                  "200": {
                    "description": "Translation updated, verses refreshed"
                  }
                }
              }
            }
          }
        }
      },
      {
        "name": "Underline Toggle API (Mock)",
        "description": "Adds or removes underline on a verse. Supports multi-user underlining.",
        "files": [
          "store/use-bible-store.ts"
        ],
        "api_doc": {
          "openapi": "3.0.0",
          "paths": {
            "/api/cells/{cellId}/underlines": {
              "post": {
                "summary": "Toggle underline on a verse",
                "parameters": [
                  {
                    "name": "cellId",
                    "in": "path",
                    "required": true,
                    "schema": {
                      "type": "string"
                    }
                  }
                ],
                "requestBody": {
                  "content": {
                    "application/json": {
                      "schema": {
                        "type": "object",
                        "properties": {
                          "book": {
                            "type": "string"
                          },
                          "chapter": {
                            "type": "integer"
                          },
                          "verse": {
                            "type": "integer"
                          },
                          "translation": {
                            "type": "string"
                          }
                        }
                      }
                    }
                  }
                },
                "responses": {
                  "200": {
                    "description": "Underline toggled"
                  }
                }
              }
            }
          }
        }
      },
      {
        "name": "Theme Toggle API (Mock)",
        "description": "Cycles theme between light, dark, and system preference.",
        "files": [
          "store/use-bible-store.ts",
          "components/header.tsx"
        ],
        "api_doc": {
          "openapi": "3.0.0",
          "paths": {
            "/api/theme": {
              "put": {
                "summary": "Set theme preference",
                "requestBody": {
                  "content": {
                    "application/json": {
                      "schema": {
                        "type": "object",
                        "properties": {
                          "theme": {
                            "type": "string",
                            "enum": [
                              "light",
                              "dark",
                              "system"
                            ]
                          }
                        }
                      }
                    }
                  }
                },
                "responses": {
                  "200": {
                    "description": "Theme updated"
                  }
                }
              }
            }
          }
        }
      },
      {
        "name": "Today Plan API (Mock)",
        "description": "Loads today's reading plan with passages and verses based on current translation.",
        "files": [
          "store/use-bible-store.ts"
        ],
        "api_doc": {
          "openapi": "3.0.0",
          "paths": {
            "/api/cells/{cellId}/plan/today": {
              "get": {
                "summary": "Get today's reading plan",
                "parameters": [
                  {
                    "name": "cellId",
                    "in": "path",
                    "required": true,
                    "schema": {
                      "type": "string"
                    }
                  },
                  {
                    "name": "tz",
                    "in": "query",
                    "schema": {
                      "type": "string",
                      "default": "Asia/Seoul"
                    }
                  }
                ],
                "responses": {
                  "200": {
                    "description": "Returns day index, title, passages, and verses"
                  }
                }
              }
            }
          }
        }
      }
    ]
  }
}
